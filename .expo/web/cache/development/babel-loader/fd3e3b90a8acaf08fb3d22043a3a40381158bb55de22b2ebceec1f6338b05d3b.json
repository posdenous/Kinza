{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport { useState, useEffect } from 'react';\nimport { auth, firestore } from '../../firebase/firebaseConfig';\nimport { UserRole } from '../auth/roles';\nimport { doc, getDoc } from 'firebase/firestore';\nexport var useUserRole = function useUserRole() {\n  var _useState = useState({\n      role: UserRole.GUEST,\n      isLoading: true,\n      error: null,\n      cityId: null,\n      onboardingStep: null\n    }),\n    _useState2 = _slicedToArray(_useState, 2),\n    state = _useState2[0],\n    setState = _useState2[1];\n  useEffect(function () {\n    var unsubscribe = auth.onAuthStateChanged(function () {\n      var _ref = _asyncToGenerator(function* (user) {\n        if (!user) {\n          setState({\n            role: UserRole.GUEST,\n            isLoading: false,\n            error: null,\n            cityId: null,\n            onboardingStep: null\n          });\n          return;\n        }\n        try {\n          var userDoc = yield getDoc(doc(firestore, 'users', user.uid));\n          if (userDoc.exists()) {\n            var userData = userDoc.data();\n            setState({\n              role: userData.role || UserRole.PARENT,\n              isLoading: false,\n              error: null,\n              cityId: userData.cityId || 'berlin',\n              onboardingStep: userData.onboardingStep || null\n            });\n          } else {\n            setState({\n              role: UserRole.PARENT,\n              isLoading: false,\n              error: null,\n              cityId: 'berlin',\n              onboardingStep: 'pick_language'\n            });\n          }\n        } catch (error) {\n          setState({\n            role: UserRole.GUEST,\n            isLoading: false,\n            error: `Error fetching user role: ${error instanceof Error ? error.message : String(error)}`,\n            cityId: null,\n            onboardingStep: null\n          });\n        }\n      });\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n    return function () {\n      return unsubscribe();\n    };\n  }, []);\n  return state;\n};\nexport default useUserRole;","map":{"version":3,"names":["useState","useEffect","auth","firestore","UserRole","doc","getDoc","useUserRole","_useState","role","GUEST","isLoading","error","cityId","onboardingStep","_useState2","_slicedToArray","state","setState","unsubscribe","onAuthStateChanged","_ref","_asyncToGenerator","user","userDoc","uid","exists","userData","data","PARENT","Error","message","String","_x","apply","arguments"],"sources":["/Users/brianwilliams/Documents/GitHub/Kinza/src/hooks/useUserRole.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { auth, firestore } from '../../firebase/firebaseConfig';\nimport { UserRole } from '../auth/roles';\nimport { doc, getDoc } from 'firebase/firestore';\nimport { User } from 'firebase/auth';\n\ninterface UserRoleState {\n  role: UserRole;\n  isLoading: boolean;\n  error: string | null;\n  cityId: string | null;\n  onboardingStep: string | null;\n}\n\n/**\n * Hook to get and manage the current user's role\n * @returns The current user's role information, loading state, and error if any\n */\nexport const useUserRole = (): UserRoleState => {\n  const [state, setState] = useState<UserRoleState>({\n    role: UserRole.GUEST, // Default role is guest\n    isLoading: true,\n    error: null,\n    cityId: null,\n    onboardingStep: null\n  });\n\n  useEffect(() => {\n    // Listen for auth state changes\n    const unsubscribe = auth.onAuthStateChanged(async (user: User | null) => {\n      if (!user) {\n        // User is not authenticated, set role to guest\n        setState({\n          role: UserRole.GUEST,\n          isLoading: false,\n          error: null,\n          cityId: null,\n          onboardingStep: null\n        });\n        return;\n      }\n\n      try {\n        // Get user data from Firestore\n        const userDoc = await getDoc(doc(firestore, 'users', user.uid));\n        \n        if (userDoc.exists()) {\n          const userData = userDoc.data();\n          setState({\n            role: userData.role || UserRole.PARENT, // Default to parent if role is not specified\n            isLoading: false,\n            error: null,\n            cityId: userData.cityId || 'berlin', // Default to Berlin if cityId is not specified\n            onboardingStep: userData.onboardingStep || null\n          });\n        } else {\n          // User document doesn't exist, set default role\n          setState({\n            role: UserRole.PARENT,\n            isLoading: false,\n            error: null,\n            cityId: 'berlin', // Default to Berlin\n            onboardingStep: 'pick_language' // First onboarding step\n          });\n        }\n      } catch (error) {\n        setState({\n          role: UserRole.GUEST,\n          isLoading: false,\n          error: `Error fetching user role: ${error instanceof Error ? error.message : String(error)}`,\n          cityId: null,\n          onboardingStep: null\n        });\n      }\n    });\n\n    // Cleanup subscription on unmount\n    return () => unsubscribe();\n  }, []);\n\n  return state;\n};\n\nexport default useUserRole;\n"],"mappings":";;AAAA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC3C,SAASC,IAAI,EAAEC,SAAS,QAAQ,+BAA+B;AAC/D,SAASC,QAAQ,QAAQ,eAAe;AACxC,SAASC,GAAG,EAAEC,MAAM,QAAQ,oBAAoB;AAehD,OAAO,IAAMC,WAAW,GAAG,SAAdA,WAAWA,CAAA,EAAwB;EAC9C,IAAAC,SAAA,GAA0BR,QAAQ,CAAgB;MAChDS,IAAI,EAAEL,QAAQ,CAACM,KAAK;MACpBC,SAAS,EAAE,IAAI;MACfC,KAAK,EAAE,IAAI;MACXC,MAAM,EAAE,IAAI;MACZC,cAAc,EAAE;IAClB,CAAC,CAAC;IAAAC,UAAA,GAAAC,cAAA,CAAAR,SAAA;IANKS,KAAK,GAAAF,UAAA;IAAEG,QAAQ,GAAAH,UAAA;EAQtBd,SAAS,CAAC,YAAM;IAEd,IAAMkB,WAAW,GAAGjB,IAAI,CAACkB,kBAAkB;MAAA,IAAAC,IAAA,GAAAC,iBAAA,CAAC,WAAOC,IAAiB,EAAK;QACvE,IAAI,CAACA,IAAI,EAAE;UAETL,QAAQ,CAAC;YACPT,IAAI,EAAEL,QAAQ,CAACM,KAAK;YACpBC,SAAS,EAAE,KAAK;YAChBC,KAAK,EAAE,IAAI;YACXC,MAAM,EAAE,IAAI;YACZC,cAAc,EAAE;UAClB,CAAC,CAAC;UACF;QACF;QAEA,IAAI;UAEF,IAAMU,OAAO,SAASlB,MAAM,CAACD,GAAG,CAACF,SAAS,EAAE,OAAO,EAAEoB,IAAI,CAACE,GAAG,CAAC,CAAC;UAE/D,IAAID,OAAO,CAACE,MAAM,CAAC,CAAC,EAAE;YACpB,IAAMC,QAAQ,GAAGH,OAAO,CAACI,IAAI,CAAC,CAAC;YAC/BV,QAAQ,CAAC;cACPT,IAAI,EAAEkB,QAAQ,CAAClB,IAAI,IAAIL,QAAQ,CAACyB,MAAM;cACtClB,SAAS,EAAE,KAAK;cAChBC,KAAK,EAAE,IAAI;cACXC,MAAM,EAAEc,QAAQ,CAACd,MAAM,IAAI,QAAQ;cACnCC,cAAc,EAAEa,QAAQ,CAACb,cAAc,IAAI;YAC7C,CAAC,CAAC;UACJ,CAAC,MAAM;YAELI,QAAQ,CAAC;cACPT,IAAI,EAAEL,QAAQ,CAACyB,MAAM;cACrBlB,SAAS,EAAE,KAAK;cAChBC,KAAK,EAAE,IAAI;cACXC,MAAM,EAAE,QAAQ;cAChBC,cAAc,EAAE;YAClB,CAAC,CAAC;UACJ;QACF,CAAC,CAAC,OAAOF,KAAK,EAAE;UACdM,QAAQ,CAAC;YACPT,IAAI,EAAEL,QAAQ,CAACM,KAAK;YACpBC,SAAS,EAAE,KAAK;YAChBC,KAAK,EAAE,6BAA6BA,KAAK,YAAYkB,KAAK,GAAGlB,KAAK,CAACmB,OAAO,GAAGC,MAAM,CAACpB,KAAK,CAAC,EAAE;YAC5FC,MAAM,EAAE,IAAI;YACZC,cAAc,EAAE;UAClB,CAAC,CAAC;QACJ;MACF,CAAC;MAAA,iBAAAmB,EAAA;QAAA,OAAAZ,IAAA,CAAAa,KAAA,OAAAC,SAAA;MAAA;IAAA,IAAC;IAGF,OAAO;MAAA,OAAMhB,WAAW,CAAC,CAAC;IAAA;EAC5B,CAAC,EAAE,EAAE,CAAC;EAEN,OAAOF,KAAK;AACd,CAAC;AAED,eAAeV,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}